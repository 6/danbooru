<div id="search">
  <%= simple_form_for(@search) do |f| %>
    <%= f.input "tags_match", :input_html => {:size => 40}, :label => false %>
  <% end %>
</div>

<div style="margin-bottom: 2em;">
  <h2>Moderation Queue</h2>
  
  <% @posts.each do |post| %>
    <div>
      <div>
        <%= link_to(image_tag(post.medium_file_url), post_path(post)) %>
      </div>
      
      <div>
        <ul>
          <li>Rating: <%= post.pretty_rating %></li>
          <li>Score: <%= post.score %></li>
          <li>Uploader: <%= link_to(post.uploader.name, user_path(post.uploader_id)) %> <%= time_ago_in_words(post.updated_at) %> ago</li>
          <% if post.is_flagged? %>
            <li>Flagged: <%= post.unapproval.reason %> by <%= post.unapproval.unapprover.name %></li>
          <% end %>
          <li>Hidden: <%= post.disapprovals.count %></li>
          <li>Tags: <%= post.tag_string %></li>
          <% if post.pools.any? %>
            <li>Pools: </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>
  
  <table width="100%">
    <tbody>
      <% @posts.each do |p| %>
        <tr id="mod-row-<%= p.id %>" class="<% if p.cached_tags =~ /(^| )duplicate($| )/ %>dupe<% elsif p.score > 2 %>good<% elsif p.score < -2 %>bad<% else %><%= cycle 'even', 'odd' %><% end %>">
          <td width="10%"><%= fast_link_to image_tag(p.preview_url, :class => (p.status == "flagged" ? "flagged" : nil), :width => p.preview_dimensions[0], :height => p.preview_dimensions[1]), {:controller => "post", :action => "show", :id => p.id}, :target => "_blank" %></td>
          <td width="90%">
            <ul>
              <li>
                <%= link_to_function "Approve", "Post.moderate(#{p.id}, 'Approve')" %> | 
                <% if @current_user.is_janitor_or_higher? %>
                  <%= link_to_function "Delete", "Post.moderate(#{p.id}, 'Delete')" %> | 
                <% end %>
                <%= link_to_function "Hide", "Post.moderate(#{p.id}, 'Hide')" %>
              </li>
              <li>Rating: <%= p.pretty_rating %></li>
              <li>Hidden: <%= p.mod_hidden_count %></li>
              <% if p.pools.any? %>
                <li>Pools: <%= h p.pools.map {|x| x.pretty_name}.join(", ") %></li>
              <% end %>
              <% if p.parent_id %>
                <li>Parent: <%= fast_link_to p.parent_id, :action => "moderate", :query => "parent:#{p.parent_id}" %></li>
              <% end %>
              <li>Tags: <%= h p.cached_tags %></li>
              <li>Score: <span id="post-score-<%= p.id %>"><%= p.score %></span> (vote <%= link_to_function "down", "Post.vote(-1, #{p.id})" %>)</li>
              <% if p.flag_detail && p.flag_detail.reason %>
                <li>Flagged: <%= h p.flag_detail.reason %></li>
              <% end %>
              <li>Uploaded by <%= fast_link_to h(p.author), :controller => "user", :action => "show", :id => p.user_id %> <%= time_ago_in_words(p.created_at) %> ago (<%= fast_link_to "mod", :action => "moderate", :query => "user:#{p.author}" %>)</li>
            </ul>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= render :partial => "footer" %>
